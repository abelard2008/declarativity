\section{Networking Libraries}
In Figures~\ref{fig:delivery-impl} and~\ref{fig:multicast-impl} we provide listings of our Bloom code for the best-effort unicast and multicast protocols mentioned above.
\label{app:network-code}

\begin{figure}[h]
\begin{scriptsize}
\begin{lstlisting}
module BestEffortDelivery
  include DeliveryProtocol

  def state
    channel :pipe_chan,
      ['@dst', 'src', 'ident'], ['payload']
  end

  declare
  def snd
    pipe_chan <~ pipe_in
  end

  declare
  def done
    pipe_sent <= pipe_in
  end
end
\end{lstlisting}
\centering
\vspace{-10pt}
\caption{Best-effort unicast messaging in Bloom.}
\label{fig:delivery-impl}
\end{scriptsize}
\vspace{-2pt}
\end{figure}


\begin{figure}[h]
\begin{scriptsize}
\begin{lstlisting}
module MulticastProtocol
  def state
    table :members, ['peer']
    interface input, :send_mcast, ['ident'], ['payload']
    interface output, :mcast_done, ['ident'], ['payload']
  end
end

module SimpleMulticast
  include MulticastProtocol
  include DeliveryProtocol

  declare
  def snd_mcast
    pipe_in <= join([send_mcast, members]).map do |s, m|
      [m.peer, @local_addr, s.ident, s.payload]
    end
  end

  declare
  def done_mcast
    mcast_done <= pipe_out.map{|p| [p.ident, p.payload]}
  end
end
\end{lstlisting}
\centering
\vspace{-10pt}
\caption{A simple unreliable multicast library in Bloom.}
\label{fig:multicast-impl}
\end{scriptsize}
\vspace{-2pt}
\end{figure}
